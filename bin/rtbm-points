#!/usr/bin/perl
use 5.10.1;
use strict;
use warnings;
use autodie qw(:all);

use RTBM;
use DateTime;

my $rtbm = RTBM->new;

my $done_lists = $rtbm->get_done('today');

use Data::Dumper;
# say Dumper $done;

my $name_of = $rtbm->lists_by_id;   # Maps ID to List name

my $total_points = 0;

foreach my $list (@$done_lists) {
    my $id = $list->{id};
    my $list_name = $name_of->{$id};

    say "=== $list_name ===";

    foreach my $task (@{ $list->{taskseries} }) {
        my $score = $rtbm->score($task, $list_name);
        say "[$task->{id}] $task->{name} [ $score ]";

        $total_points += $score;
    }
}

say "TOTAL POINTS = $total_points\n";

# system('bmndr','rtm_inbox_size',$num_tasks, "auto: rtbm");
# system('bmndr','rtm_inbox_age', $max_age,   "auto: rtbm");

say "Done";
